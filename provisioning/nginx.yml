---
# https://www.google.com/search?q=linux%20server%20nginx
# https://github.com/linuxserver/docker-mods/tree/nginx-proxy-confs

- name: Load proxy-conf configs
  synchronize:
    src: ../files/nginx/
    dest: /config/nginx/nginx/proxy-confs/
    recursive: yes
    checksum: yes
    archive: no
    times: no
  register: proxy_conf_config # register so that on change it restarts the nginx container if running

- name: Start nginx container
  docker_container: 
    image: lscr.io/linuxserver/nginx
    name: nginx
    env:
      PUID=1000
      PGID=1000
      TZ=Europe/London
      DOCKER_MODS=linuxserver/mods:nginx-proxy-confs
    volumes:
      - /config/nginx:/config
    ports:
      - 80:80
      - 443:443
    restart_policy: unless-stopped
    restart: "{{ proxy_conf_config.changed }}"
    networks:
      - name: home_server

    # TODO: auto config the proxy.confs for the services we have
